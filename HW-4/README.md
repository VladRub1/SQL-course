## üë®üèª‚Äçüíª –î–ó ‚Ññ4 –ì–ª–∞–≤–∞ 5. –û—Å–Ω–æ–≤—ã —è–∑—ã–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
1. [–ó–∞–¥–∞–Ω–∏–µ 2.](#–∑–∞–¥–∞–Ω–∏–µ_2)
2. [–ó–∞–¥–∞–Ω–∏–µ 9.](#–∑–∞–¥–∞–Ω–∏–µ_9)
3. [–ó–∞–¥–∞–Ω–∏–µ 17.](#–∑–∞–¥–∞–Ω–∏–µ_17)
4. [–ó–∞–¥–∞–Ω–∏–µ 18.](#–∑–∞–¥–∞–Ω–∏–µ_18)

### **–ó–∞–¥–∞–Ω–∏–µ 2.** <a name="–∑–∞–¥–∞–Ω–∏–µ_2"></a>

<details>
<summary>üîΩ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞–Ω–∏–µ üîΩ</summary>
–ó–∞–¥–∞–Ω–∏–µ:

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É–∂–µ –Ω–∞–ª–æ–∂–µ–Ω—ã –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã —Ç–∞–±–ª–∏—Ü—ã ¬´–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å¬ª 
(`progress)`. –í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥–æ–π `\d` —É—Ç–∏–ª–∏—Ç—ã `psql`. –ê —Ç–µ–ø–µ—Ä—å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ 
–¥–ª—è —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Ç–∞–±–ª–∏—Ü—ã.

–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç. –î–æ–±–∞–≤—å—Ç–µ –≤ —Ç–∞–±–ª–∏—Ü—É `progress`
–µ—â–µ –æ–¥–∏–Ω –∞—Ç—Ä–∏–±—É—Ç ‚Äî ¬´–§–æ—Ä–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞–Ω–∏–π¬ª (`test_form`), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç
–ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è: ¬´—ç–∫–∑–∞–º–µ–Ω¬ª –∏–ª–∏ ¬´–∑–∞—á–µ—Ç¬ª. –¢–æ–≥–¥–∞ –Ω–∞–±–æ—Ä –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö 
–∑–Ω–∞—á–µ–Ω–∏–π –∞—Ç—Ä–∏–±—É—Ç–∞ ¬´–û—Ü–µ–Ω–∫–∞¬ª (`mark`) –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ç–æ–≥–æ, —ç–∫–∑–∞–º–µ–Ω –∏–ª–∏ –∑–∞—á–µ—Ç 
–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –ø–æ –¥–∞–Ω–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ. –ï—Å–ª–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω —ç–∫–∑–∞–º–µ–Ω, —Ç–æ–≥–¥–∞
–¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è 3, 4, 5, –µ—Å–ª–∏ –∑–∞—á–µ—Ç ‚Äî —Ç–æ–≥–¥–∞ 0 (–Ω–µ –∑–∞—á—Ç–µ–Ω–æ) –∏–ª–∏ 1 (–∑–∞—á—Ç–µ–Ω–æ).

–ù–µ –∑–∞–±—É–¥—å—Ç–µ, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è `NULL` –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ `test_form` –∏ `mark` –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è.
–ù–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∞–∫–∏–º:

```SQL
ALTER TABLE progress
ADD CHECK (
( test_form = '—ç–∫–∑–∞–º–µ–Ω' AND mark IN ( 3, 4, 5 ) )
OR
( test_form = '–∑–∞—á–µ—Ç' AND mark IN ( 0, 1 ) )
);
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ 
`progress`. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã `INSERT`, –∫–∞–∫ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—é, 
—Ç–∞–∫ –∏ –Ω–∞—Ä—É—à–∞—é—â–∏–µ –µ–≥–æ.

–í —Ç–∞–±–ª–∏—Ü–µ —É–∂–µ –±—ã–ª–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ `mark`. –ö–∞–∫
–≤—ã –¥—É–º–∞–µ—Ç–µ, –Ω–µ –±—É–¥–µ—Ç –ª–∏ –æ–Ω–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –Ω–æ–≤—ã–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
—ç—Ç—É –≥–∏–ø–æ—Ç–µ–∑—É. –ï—Å–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç, —Ç–æ–≥–¥–∞ —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 
–∏ —Å–Ω–æ–≤–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É.

–ü–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫–æ–µ –µ—â–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–ª—è
—ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã?
</details>

–û—Ç–≤–µ—Ç:

–°–æ–∑–¥–∞–¥–∏–º —Ç—Ä–µ–±—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
```SQL
CREATE TABLE students
( record_book numeric( 5 ) NOT NULL,
 name text NOT NULL,
 doc_ser numeric( 4 ),
 doc_num numeric( 6 ),
 PRIMARY KEY ( record_book )
);

CREATE TABLE progress
( record_book numeric( 5 ) NOT NULL,
 subject text NOT NULL,
 acad_year text NOT NULL,
 term numeric( 1 ) NOT NULL CHECK ( term = 1 OR term = 2 ),
 mark numeric( 1 ) NOT NULL CHECK ( mark >= 3 AND mark <= 5 )
 DEFAULT 5,
 FOREIGN KEY ( record_book )
 REFERENCES students ( record_book )
 ON DELETE CASCADE
 ON UPDATE CASCADE
);
```
–î–æ–±–∞–≤–∏–º –ø–∞—Ä—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:
```SQL
INSERT INTO students 
VALUES 
(12345, '–ê–ª–µ–∫—Å–µ–µ–≤ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á', 1234, 567890),
(15796, '–ü–µ—Ç—Ä–æ–≤ –í–∞—Å–∏–ª–∏–π –ò–≤–∞–Ω–æ–≤–∏—á', 5423, 124583),
(73548, '–ë—Ä–∞—É–Ω –î–∂–µ–π–º—Å', 1111, 123456);
```

–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É–∂–µ –Ω–∞–ª–æ–∂–µ–Ω—ã –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã —Ç–∞–±–ª–∏—Ü—ã (`progress`):
```SQL
\d progress
```
```
                             –¢–∞–±–ª–∏—Ü–∞ "public.progress"
   –°—Ç–æ–ª–±–µ—Ü   |     –¢–∏–ø      | –ü—Ä–∞–≤–∏–ª–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ | –î–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å NULL | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 
-------------+--------------+--------------------+-------------------+--------------
 record_book | numeric(5,0) |                    | not null          | 
 subject     | text         |                    | not null          | 
 acad_year   | text         |                    | not null          | 
 term        | numeric(1,0) |                    | not null          | 
 mark        | numeric(1,0) |                    | not null          | 5
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-–ø—Ä–æ–≤–µ—Ä–∫–∏:
    "progress_mark_check" CHECK (mark >= 3::numeric AND mark <= 5::numeric)
    "progress_term_check" CHECK (term = 1::numeric OR term = 2::numeric)
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞:
    "progress_record_book_fkey" FOREIGN KEY (record_book) REFERENCES students(record_book) ON UPDATE CASCADE ON DELETE CASCADE
```

–í–∏–¥–∏–º —Ç—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –¥–≤–∞ `CHECK` –∏ –æ–¥–∏–Ω `FOREIGN KEY`.
–î–æ–±–∞–≤–∏–º –≤ —Ç–∞–±–ª–∏—Ü—É `progress` –∞—Ç—Ä–∏–±—É—Ç ¬´–§–æ—Ä–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞–Ω–∏–π¬ª (`test_form`):
```SQL
ALTER TABLE progress 
    ADD COLUMN test_form text NOT NULL 
        CHECK(test_form in ('—ç–∫–∑–∞–º–µ–Ω', '–∑–∞—á–µ—Ç'));
```

–î–æ–±–∞–≤–∏–º –Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:
```SQL
ALTER TABLE progress
ADD CHECK (
( test_form = '—ç–∫–∑–∞–º–µ–Ω' AND mark IN ( 3, 4, 5 ) )
OR
( test_form = '–∑–∞—á–µ—Ç' AND mark IN ( 0, 1 ) )
);
```

–°–µ–π—á–∞—Å –≤ —Ç–∞–±–ª–∏—Ü–µ `progress` –µ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `progress_mark_check`
–Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ `mark`. –û–Ω–æ –±—É–¥–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –Ω–æ–≤—ã–º
–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º, –µ—Å–ª–∏ —É —Å—Ç—É–¥–µ–Ω—Ç–∞ –±—ã–ª –∑–∞—á–µ—Ç –∏ –æ–Ω –ø–æ–ª—É—á–∏–ª 0 –∏–ª–∏ 1, —Ç.–∫.
—ç—Ç–∏ —á–∏—Å–ª–∞ –º–µ–Ω—å—à–µ 3.

–ü—Ä–æ–≤–µ—Ä–∏–º –≥–∏–ø–æ—Ç–µ–∑—É:
```SQL
INSERT INTO progress 
VALUES 
(12345, '–§–∏–ª–æ—Å–æ—Ñ–∏—è', '2023/2024', 2, 1, '–∑–∞—á–µ—Ç'),
(15796, '–§–∏–ª–æ—Å–æ—Ñ–∏—è', '2023/2024', 2, 0, '–∑–∞—á–µ—Ç');
```
–ó–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É, –º—ã –≤–≤–µ–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
```
–û–®–ò–ë–ö–ê:  –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ "progress" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ-–ø—Ä–æ–≤–µ—Ä–∫—É "progress_mark_check"
–ü–û–î–†–û–ë–ù–û–°–¢–ò:  –û—à–∏–±–æ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç (12345, –§–∏–ª–æ—Å–æ—Ñ–∏—è, 2023/2024, 2, 1, –∑–∞—á–µ—Ç).
```
–£–¥–∞–ª–∏–º —Å—Ç–∞—Ä–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:
```SQL
ALTER TABLE progress 
    DROP CONSTRAINT progress_mark_check ;
```
–¢–µ–ø–µ—Ä—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
```SQL
INSERT INTO progress 
VALUES 
(12345, '–§–∏–ª–æ—Å–æ—Ñ–∏—è', '2023/2024', 2, 1, '–∑–∞—á–µ—Ç'),
(15796, '–§–∏–ª–æ—Å–æ—Ñ–∏—è', '2023/2024', 2, 0, '–∑–∞—á–µ—Ç');

INSERT 0 2
```
```SQL
SELECT * FROM progress ;

 record_book |     subject      | acad_year | term | mark | test_form 
-------------+------------------+-----------+------+------+-----------
       12345 | –§–∏–ª–æ—Å–æ—Ñ–∏—è        | 2023/2024 |    2 |    1 | –∑–∞—á–µ—Ç
       15796 | –§–∏–ª–æ—Å–æ—Ñ–∏—è        | 2023/2024 |    2 |    0 | –∑–∞—á–µ—Ç
(2 —Å—Ç—Ä–æ–∫–∏)
```

–ü—Ä–æ–≤–µ—Ä–∏–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ `progress`:
```SQL
INSERT INTO progress 
VALUES 
(12345, '–õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞', '2023/2024', 1, 5, '—ç–∫–∑–∞–º–µ–Ω'),
(15796, '–õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞', '2023/2024', 1, 3, '—ç–∫–∑–∞–º–µ–Ω'),
(73548, '–õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞', '2023/2024', 1, 2, '—ç–∫–∑–∞–º–µ–Ω');
```
```
–û–®–ò–ë–ö–ê:  –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ "progress" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ-–ø—Ä–æ–≤–µ—Ä–∫—É "progress_check"
–ü–û–î–†–û–ë–ù–û–°–¢–ò:  –û—à–∏–±–æ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç (73548, –õ–∏–Ω–µ–π–Ω–∞—è –∞–ª–≥–µ–±—Ä–∞, 2023/2024, 1, 2, —ç–∫–∑–∞–º–µ–Ω).
```

```SQL
INSERT INTO progress 
VALUES 
(12345, '–§–∏–ª–æ—Å–æ—Ñ–∏—è', '2023/2024', 2, 1, '–∑–∞—á–µ—Ç'),
(15796, '–§–∏–ª–æ—Å–æ—Ñ–∏—è', '2023/2024', 2, 0, '–∑–∞—á–µ—Ç'),
(73548, '–§–∏–ª–æ—Å–æ—Ñ–∏—è', '2023/2024', 2, 5, '–∑–∞—á–µ—Ç');
```
```
–û–®–ò–ë–ö–ê:  –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ "progress" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ-–ø—Ä–æ–≤–µ—Ä–∫—É "progress_check"
–ü–û–î–†–û–ë–ù–û–°–¢–ò:  –û—à–∏–±–æ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç (73548, –§–∏–ª–æ—Å–æ—Ñ–∏—è, 2023/2024, 2, 5, –∑–∞—á–µ—Ç).
```
–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–í –∫–∞—á–µ—Å—Ç–≤–µ –µ—â–µ –æ–¥–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–≤—É—Ö —Å—Ç–æ–ª–±—Ü–æ–≤: `record_book` –∏ `subject`, —á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∞–ª–∏—á–∏—è
–≤ —Ç–∞–±–ª–∏—Ü–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–≤—É—Ö –∏ –±–æ–ª–µ–µ –æ—Ü–µ–Ω–æ–∫ –∑–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫—É—Ä—Å —É –æ–¥–Ω–æ–≥–æ 
—Å—Ç—É–¥–µ–Ω—Ç–∞. –ë—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –≤ —Å–ª—É—á–∞–µ –ø–µ—Ä–µ—Å–¥–∞—á–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –±—É–¥–µ—Ç –≤–Ω–æ—Å–∏—Ç—å—Å—è
–∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–æ–∫—É.

```SQL
ALTER TABLE progress
ADD CONSTRAINT unique_mark UNIQUE (record_book, subject );
```
–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:
```SQL
\d progress
```
```
                             –¢–∞–±–ª–∏—Ü–∞ "public.progress"
   –°—Ç–æ–ª–±–µ—Ü   |     –¢–∏–ø      | –ü—Ä–∞–≤–∏–ª–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ | –î–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å NULL | –ü–æ —É–º–æ–ª—á–∞
–Ω–∏—é 
-------------+--------------+--------------------+-------------------+----------
----
 record_book | numeric(5,0) |                    | not null          | 
 subject     | text         |                    | not null          | 
 acad_year   | text         |                    | not null          | 
 term        | numeric(1,0) |                    | not null          | 
 mark        | numeric(1,0) |                    | not null          | 5
 test_form   | text         |                    | not null          | 
–ò–Ω–¥–µ–∫—Å—ã:
    "unique_mark" UNIQUE CONSTRAINT, btree (record_book, subject)
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-–ø—Ä–æ–≤–µ—Ä–∫–∏:
    "progress_check" CHECK (test_form = '—ç–∫–∑–∞–º–µ–Ω'::text AND (mark = ANY (ARRAY[3
::numeric, 4::numeric, 5::numeric])) OR test_form = '–∑–∞—á–µ—Ç'::text AND (mark = AN
Y (ARRAY[0::numeric, 1::numeric])))
    "progress_term_check" CHECK (term = 1::numeric OR term = 2::numeric)
    "progress_test_form_check" CHECK (test_form = ANY (ARRAY['—ç–∫–∑–∞–º–µ–Ω'::text, '–∑
–∞—á–µ—Ç'::text]))
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞:
    "progress_record_book_fkey" FOREIGN KEY (record_book) REFERENCES students(re
cord_book) ON UPDATE CASCADE ON DELETE CASCADE
```
–í–∏–¥–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `unique_mark`, –¥–ª—è –Ω–µ–≥–æ –±—ã–ª —Å–æ–∑–¥–∞–Ω –∏–Ω–¥–µ–∫—Å.

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –µ–≥–æ:
```SQL
INSERT INTO progress 
VALUES 
(12345, '–ò—Å—Ç–æ—Ä–∏—è', '2022/2023', 2, 1, '–∑–∞—á–µ—Ç'),
(15796, '–ò—Å—Ç–æ—Ä–∏—è', '2022/2023', 2, 0, '–∑–∞—á–µ—Ç'),
(73548, '–ò—Å—Ç–æ—Ä–∏—è', '2022/2023', 2, 1, '–∑–∞—á–µ—Ç');
```
–í–≤–µ–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑. –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–µ–º –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—É—é –æ—Ü–µ–Ω–∫—É —Å—Ç—É–¥–µ–Ω—Ç—É,
–∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–¥–∞–ª –∫—É—Ä—Å, –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–µ–º–µ—Å—Ç—Ä–µ:
```SQL
INSERT INTO progress 
VALUES (15796, '–ò—Å—Ç–æ—Ä–∏—è', '2023/2024', 1, 1, '–∑–∞—á–µ—Ç');
```
–ü–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É:
```
–û–®–ò–ë–ö–ê:  –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ "unique_mark"
–ü–û–î–†–û–ë–ù–û–°–¢–ò:  –ö–ª—é—á "(record_book, subject)=(15796, –ò—Å—Ç–æ—Ä–∏—è)" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
```
–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫, –∫–∞–∫ –º—ã —Ö–æ—Ç–µ–ª–∏!

---
### **–ó–∞–¥–∞–Ω–∏–µ 9.** <a name="–∑–∞–¥–∞–Ω–∏–µ_9"></a>

<details>
<summary>üîΩ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞–Ω–∏–µ üîΩ</summary>
–ó–∞–¥–∞–Ω–∏–µ:

–í —Ç–∞–±–ª–∏—Ü–µ ¬´–°—Ç—É–¥–µ–Ω—Ç—ã¬ª (`students`) –µ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç `name`, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ª–æ–∂–µ–Ω–æ 
–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `NOT NULL`. –ö–∞–∫ –≤—ã –¥—É–º–∞–µ—Ç–µ, —á—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ –Ω–æ–≤–æ–π
—Å—Ç—Ä–æ–∫–∏ –≤ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É –¥–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç—É name –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É?

–ù–∞–ø—Ä–∏–º–µ—Ä:
```SQL
INSERT INTO students ( record_book, name, doc_ser, doc_num )
VALUES ( 12300, '', 0402, 543281 );
```

–ù–∞–≤–µ—Ä–Ω–æ–µ, –ø—Ä–æ–µ–∫—Ç–∏—Ä—É—è —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É, –º—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –≤—Å–µ –∂–µ, —á—Ç–æ–±—ã –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
–≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ `name` –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö? –ö–∞–∫–æ–µ 
—Ä–µ—à–µ–Ω–∏–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å? 
–í–∏–¥–∏–º–æ, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `CHECK` –¥–ª—è
—Å—Ç–æ–ª–±—Ü–∞ `name`. 

–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –∏–∑—É—á–∏–ª–∏ –∫–æ–º–∞–Ω–¥—É `ALTER TABLE`, —Ç–æ —É–¥–∞–ª–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É 
`students` –∏ —Å–æ–∑–¥–∞–π—Ç–µ –µ–µ –∑–∞–Ω–æ–≤–æ —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∞ –µ—Å–ª–∏ –≤—ã —É–∂–µ
–ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å –∫–æ–º–∞–Ω–¥–æ–π `ALTER TABLE`, —Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:

```SQL
ALTER TABLE students ADD CHECK ( name <> '' );
```

–î–æ–±–∞–≤–∏–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–µ–ø–µ—Ä—å –≤—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É `students` —Å—Ç—Ä–æ–∫—É
(`row`), –≤ –∫–æ—Ç–æ—Ä–æ–π –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ `name` –±—ã–ª–æ –±—ã –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π (`string`).
–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–∏–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞
`name` —Å—Ç—Ä–æ–∫—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é —Å–Ω–∞—á–∞–ª–∞ –æ–¥–∏–Ω –ø—Ä–æ–±–µ–ª, –∞ –ø–æ—Ç–æ–º ‚Äî –¥–≤–∞ –ø—Ä–æ–±–µ–ª–∞.
```SQL
INSERT INTO students VALUES ( 12346, ' ', 0406, 112233 );
INSERT INTO students VALUES ( 12347, ' ', 0407, 112234 );
```
–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã ¬´—É–≤–∏–¥–µ—Ç—å¬ª —ç—Ç–∏ –ø—Ä–æ–±–µ–ª—ã –≤ –≤—ã–±–æ—Ä–∫–µ, —Å–¥–µ–ª–∞–µ–º —Ç–∞–∫:
```SQL
SELECT *, length( name ) FROM students;
```
–û–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, —ç—Ç–∏ –Ω–µ–≤–∏–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç –Ω–µ–Ω—É–ª–µ–≤—É—é –¥–ª–∏–Ω—É. –ß—Ç–æ –¥–µ–ª–∞—Ç—å,
—á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å —Ç–∞–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π-–Ω–µ–≤–∏–¥–∏–º–æ–∫? –û–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤: –≤–æ–∑–ª–æ–∂–∏—Ç—å
–ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∞–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É. –ê —á—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞
—É—Ä–æ–≤–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `students`? –ö–∞–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å? 

–í —Ä–∞–∑–¥–µ–ª–µ 9.4 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ¬´–°—Ç—Ä–æ–∫–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã¬ª –µ—Å—Ç—å
—Ñ—É–Ω–∫—Ü–∏—è `trim`. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –µ—é. –ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –∏–∑—É—á–∏–ª–∏ –∫–æ–º–∞–Ω–¥—É 
`ALTER TABLE`, —Ç–æ —É–¥–∞–ª–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `students` –∏ —Å–æ–∑–¥–∞–π—Ç–µ –µ–µ –∑–∞–Ω–æ–≤–æ —Å —É—á–µ—Ç–æ–º
–Ω–æ–≤–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∞ –µ—Å–ª–∏ —É–∂–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å –Ω–µ–π, —Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
```SQL
ALTER TABLE students ADD CHECK (...);
```
–ï—Å—Ç—å –ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ ¬´–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å¬ª (progress)?
</details>

–û—Ç–≤–µ—Ç:

–ï—Å–ª–∏ –ø—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏ `NOT NULL` –≤–≤–µ—Å—Ç–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ 
`name` –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–π–¥–µ—Ç –∏ –¥–æ–±–∞–≤–∏—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å "–ø—É—Å—Ç—ã–º"
–∏–º–µ–Ω–µ–º:
```SQL
INSERT INTO students ( record_book, name, doc_ser, doc_num )
VALUES ( 12300, '', 0402, 543281 );

select * from students ;

 record_book |          name           | doc_ser | doc_num 
-------------+-------------------------+---------+---------
       12345 | –ê–ª–µ–∫—Å–µ–µ–≤ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á  |    1234 |  567890
       15796 | –ü–µ—Ç—Ä–æ–≤ –í–∞—Å–∏–ª–∏–π –ò–≤–∞–Ω–æ–≤–∏—á |    5423 |  124583
       73548 | –ë—Ä–∞—É–Ω –î–∂–µ–π–º—Å            |    1111 |  123456
       12300 |                         |     402 |  543281
(4 —Å—Ç—Ä–æ–∫–∏)
```

–£–¥–∞–ª–∏–º –∑–∞–ø–∏—Å—å —Å –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π –∏ –¥–æ–±–∞–≤–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É:
```SQL
DELETE from students WHERE name = '' ;
ALTER TABLE students ADD CHECK ( name <> '' );
```
–¢–µ–ø–µ—Ä—å —Ç–∞–∫–∞—è –∑–∞–ø–∏—Å—å –Ω–µ –ø—Ä–æ–π–¥–µ—Ç:
```SQL
INSERT INTO students ( record_book, name, doc_ser, doc_num )
VALUES ( 12300, '', 0402, 543281 );

–û–®–ò–ë–ö–ê:  –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ "students" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ-–ø—Ä–æ–≤–µ—Ä–∫—É "students_name_check"
–ü–û–î–†–û–ë–ù–û–°–¢–ò:  –û—à–∏–±–æ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç (12300, , 402, 543281).
```
–ù–æ —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å:
```SQL
INSERT INTO students VALUES ( 12346, ' ', 0406, 112233 );
INSERT INTO students VALUES ( 12347, '  ', 0407, 112234 );
```
–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–∏—Ö:
```SQL
SELECT 
    *, 
    length(name),
    length(trim(name))
FROM students;

 record_book |          name           | doc_ser | doc_num | length | length 
-------------+-------------------------+---------+---------+--------+--------
       12345 | –ê–ª–µ–∫—Å–µ–µ–≤ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á  |    1234 |  567890 |     22 |     22
       15796 | –ü–µ—Ç—Ä–æ–≤ –í–∞—Å–∏–ª–∏–π –ò–≤–∞–Ω–æ–≤–∏—á |    5423 |  124583 |     23 |     23
       73548 | –ë—Ä–∞—É–Ω –î–∂–µ–π–º—Å            |    1111 |  123456 |     12 |     12
       12346 |                         |     406 |  112233 |      1 |      0
       12347 |                         |     407 |  112234 |      2 |      0
(5 —Å—Ç—Ä–æ–∫)
```
–í–∏–¥–∏–º –¥–ª–∏–Ω—É –Ω–∞—à–∏—Ö —Å—Ç–æ–∫ –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤: 1 –∏ 2.
–ß—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å –∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π trim, –∫–æ—Ç–æ—Ä–∞—è
—É–¥–∞–ª—è–µ—Ç –ø—Ä–æ–±–µ–ª—ã —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞ –æ—Ç —Å—Ç—Ä–æ–∫–∏. –í–∏–¥–Ω–æ, —á—Ç–æ, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å
–µ–µ –∫ —Å—Ç—Ä–æ–∫–∞–º –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤, –æ–Ω–∏ –ø—Ä–µ–≤—Ä–∞—Ç—è—Ç—Å—è –≤ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –∏ –∏—Ö
–¥–ª–∏–Ω–∞ –±—É–¥–µ—Ç 0. –ü–µ—Ä–µ–¥ —ç—Ç–∏–º —Ç–æ–∂–µ —É–¥–∞–ª–∏–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏.

```SQL
DELETE from students 
WHERE length(trim(name)) = 0 ;

ALTER TABLE students ADD CHECK ( length(trim(name) ) > 0);
```
–¢–µ–ø–µ—Ä—å –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è –≤–≤–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ —Å–∏–º–≤–æ–ª–æ–≤ –¥–∞–∂–µ –∏–∑ –±–æ–ª—å—à–æ–≥–æ 
—á–∏—Å–ª–∞ –ø—Ä–æ–±–µ–ª–æ–≤:
```SQL
INSERT INTO students VALUES ( 12346, ' ', 0406, 112233 );
INSERT INTO students VALUES ( 12347, '     ', 0407, 112234 );  

–û–®–ò–ë–ö–ê:  –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ "students" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ-–ø—Ä–æ–≤–µ—Ä–∫—É "students_name_check1"
–ü–û–î–†–û–ë–ù–û–°–¢–ò:  –û—à–∏–±–æ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç (12346,  , 406, 112233).
–û–®–ò–ë–ö–ê:  –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ "students" –Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ-–ø—Ä–æ–≤–µ—Ä–∫—É "students_name_check1"
–ü–û–î–†–û–ë–ù–û–°–¢–ò:  –û—à–∏–±–æ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç (12347,      , 407, 112234).
```

–ï—Å–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç—å –æ —Ç–∞–±–ª–∏—Ü–µ ¬´–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å¬ª (progress), –æ–Ω–∞ –∏–º–µ–µ—Ç —Ç–µ –∂–µ
—Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∏–∑-–∑–∞ –ø–æ–ª–µ–π —Ç–∏–ø–∞ `text`: subject, acad_year. –£ –ø–æ–ª—è test_form
—Ç–∞–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å, —Ç.–∫. –¥–ª—è –Ω–µ–≥–æ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
–Ω–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏—é "–∑–∞—á–µ—Ç" –∏–ª–∏ "—ç–∫–∑–∞–º–µ–Ω".
```SQL
INSERT INTO progress VALUES (12345, '', '', 2, 1, '–∑–∞—á–µ—Ç');
INSERT INTO progress VALUES (15796, '  ', '   ', 1, 5, '—ç–∫–∑–∞–º–µ–Ω');

select *, length(subject), length(acad_year) from progress ;

 record_book | subject | acad_year | term | mark | test_form | length | length 
-------------+---------+-----------+------+------+-----------+--------+--------
       12345 |         |           |    2 |    1 | –∑–∞—á–µ—Ç     |      0 |      0
       15796 |         |           |    1 |    5 | —ç–∫–∑–∞–º–µ–Ω   |      2 |      3
(2 —Å—Ç—Ä–æ–∫–∏)
```

–ö–æ–Ω–µ—á–Ω–æ, —ç—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ –≤—ã—à–µ.

---
### **–ó–∞–¥–∞–Ω–∏–µ 17.** <a name="–∑–∞–¥–∞–Ω–∏–µ_17"></a>

<details>
<summary>üîΩ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞–Ω–∏–µ üîΩ</summary>
–ó–∞–¥–∞–Ω–∏–µ:

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å, —É—Å–ª–æ–≤–Ω–æ –≥–æ–≤–æ—Ä—è, –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º–∏.
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫ –µ–≥–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
–ª–∏—à—å —á–∞—Å—Ç—å —Å—Ç–æ–ª–±—Ü–æ–≤ –±–∞–∑–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã (—Ç–∞–±–ª–∏—Ü). –ù–∞–ø—Ä–∏–º–µ—Ä:
```SQL
CREATE VIEW airports_names AS
SELECT airport_code, airport_name, city
FROM airports;
SELECT * FROM airports_names;
```
–í –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –Ω–µ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –±–∞–∑–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
(—Ç–∞–±–ª–∏—Ü), –∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∏—Ö –æ—Ç–±–æ—Ä —Å –ø–æ–º–æ—â—å—é —Ñ—Ä–∞–∑ `WHERE` –∏–ª–∏ `HAVING`.
–ù–∞–ø—Ä–∏–º–µ—Ä:
```SQL
CREATE VIEW siberian_airports AS
SELECT * FROM airports
WHERE city = '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫' OR city = '–ö–µ–º–µ—Ä–æ–≤–æ';
SELECT * FROM siberian_airports;
```
–ö–æ–Ω–µ—á–Ω–æ, –≤–ø–æ–ª–Ω–µ –≤–æ–∑–º–æ–∂–µ–Ω –∏ —Å–º–µ—à–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ–≥–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫
—Å–ø–∏—Å–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤, —Ç–∞–∫ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
–ü–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –±—ã–ª–æ –±—ã —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–ª—è –Ω–∞—à–µ–π
–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ¬´–ê–≤–∏–∞–ø–µ—Ä–µ–≤–æ–∑–∫–∏¬ª. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–µ—Å—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≥—Ä—É–ø–ø
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: –ø–∏–ª–æ—Ç—ã, –¥–∏—Å–ø–µ—Ç—á–µ—Ä—ã, –ø–∞—Å—Å–∞–∂–∏—Ä—ã, –∫–∞—Å—Å–∏—Ä—ã.
–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö –≤ —Ä–∞–±–æ—Ç–µ.
</details>

–û—Ç–≤–µ—Ç:

–ú–æ—è –∏–¥–µ—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∏–ª–æ—Ç—ã –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—ã 
–∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ "–î–æ–º–æ–¥–µ–¥–æ–≤–æ" - –ø–æ–º–æ—á—å –ø–æ–Ω—è—Ç—å, —É—Å–ø–µ—é—Ç –ª–∏ –æ–Ω–∏ –º–µ–∂–¥—É —Ä–µ–π—Å–∞–º–∏
–≤—ã–ø–∏—Ç—å –∫–æ—Ñ–µ —Å–æ —Å–≤–æ–∏–º–∏ –∫–æ–ª–ª–µ–≥–∞–º–∏.

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –±—Ä–∞—Ç—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã flights —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —Ä–µ–π—Å—ã, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
–∏—Ö –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å —á–∏—Å–ª–æ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —á–∞—Å–æ–≤.
–ë—ã—Å—Ç—Ä–æ–≥–æ –≤–∑–≥–ª—è–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–≥–æ –ø–∏–ª–æ—Ç–∞ –∏–ª–∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
—Å –∫–∞–∫–æ–≥–æ —Ä–µ–π—Å–∞ –º–æ–∂–Ω–æ –ø–æ–∑–≤–∞—Ç—å –Ω–∞ –∫–æ—Ñ–µ –≤ –ø–µ—Ä–µ—Ä—ã–≤–µ.

–ü–æ—Å–∫–æ–ª—å–∫—É –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –∑–∞ 2016 –≥–æ–¥, –≤ –∫–∞—á–µ—Å—Ç–≤–µ "–∑–∞–≥–ª—É—à–∫–∏" —è –≤—ã–±—Ä–∞–ª 
14 –æ–∫—Ç. 2016 –≥.
```SQL
CREATE VIEW time_to_flights AS
SELECT 
    flight_no,
    scheduled_departure,
    aircraft_code,
    -- –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ current_timestamp
    round((EXTRACT(
    EPOCH FROM scheduled_departure - '2016-10-14 14:35:00+03'::timestamptz
    ) / 3600)::numeric(10,4), 2) as hours_to_flight
FROM flights
WHERE departure_airport = 'DME' 
 -- –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ current_date
 AND scheduled_departure::date = '2016-10-14'::date
ORDER BY hours_to_flight;

SELECT * FROM time_to_flights WHERE hours_to_flight >= 0;
```
```
 flight_no |  scheduled_departure   | aircraft_code | hours_to_flight 
-----------+------------------------+---------------+-----------------
 PG0368    | 2016-10-14 14:35:00+03 | CR2           |            0.00
 PG0593    | 2016-10-14 14:50:00+03 | CN1           |            0.25
 PG0645    | 2016-10-14 15:05:00+03 | CR2           |            0.50
 PG0657    | 2016-10-14 15:15:00+03 | CR2           |            0.67
 PG0607    | 2016-10-14 15:15:00+03 | CR2           |            0.67
 PG0054    | 2016-10-14 16:05:00+03 | CN1           |            1.50
 PG0289    | 2016-10-14 16:25:00+03 | CR2           |            1.83
 PG0210    | 2016-10-14 17:00:00+03 | 733           |            2.42
 PG0220    | 2016-10-14 17:05:00+03 | 763           |            2.50
 PG0019    | 2016-10-14 17:10:00+03 | CR2           |            2.58
 PG0212    | 2016-10-14 17:20:00+03 | 321           |            2.75
 PG0605    | 2016-10-14 17:40:00+03 | SU9           |            3.08
 PG0404    | 2016-10-14 18:05:00+03 | 321           |            3.50
 PG0416    | 2016-10-14 18:20:00+03 | CR2           |            3.75
 PG0213    | 2016-10-14 18:20:00+03 | 321           |            3.75
 PG0118    | 2016-10-14 18:55:00+03 | SU9           |            4.33
 PG0168    | 2016-10-14 19:05:00+03 | 319           |            4.50
 PG0208    | 2016-10-14 19:40:00+03 | 763           |            5.08
(18 —Å—Ç—Ä–æ–∫)
```
–í–∏–¥–∏–º, —á—Ç–æ —Ä–µ–π—Å—ã –∏–∑ "–î–æ–º–æ–¥–µ–¥–æ–≤–æ" –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã, –Ω–∞—á–∏–Ω–∞—è —Å 
2016-10-14 14:35 –∏ –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è.

–°–ª–µ–¥—É—é—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –∫–∞—Å—Å–∏—Ä–∞–º –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–Ω–∏–º–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ 
–º–µ—Å—Ç –≤ —Å–∞–º–æ–ª–µ—Ç–µ –æ—Å—Ç–∞–ª–æ—Å—å, —É—á–∏—Ç—ã–≤–∞—è —á–∏—Å–ª–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤.
–ù–∞–ø—Ä–∏–º–µ—Ä, —ç—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ—á–µ—Ä–µ–¥–∏ –ª—é–¥–µ–π –∏ –Ω–µ –≤—ã–¥–∞—Ç—å –ø–æ—Å–∞–¥–æ—á–Ω—ã—Ö 
—Ç–∞–ª–æ–Ω–æ–≤ –±–æ–ª—å—à–µ, —á–µ–º –º–µ—Å—Ç –≤ —Å–∞–º–æ–ª–µ—Ç–µ.

–í –Ω–∞—á–∞–ª–µ —è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü—ã seats —Å—á–∏—Ç–∞—é —á–∏—Å–ª–æ –º–µ—Å—Ç –≤ –∫–∞–∂–¥–æ–º —Å–∞–º–æ–ª–µ—Ç–µ, –ø–æ—Ç–æ–º
–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü flights –∏ boarding_passes —Å—á–∏—Ç–∞—é —á–∏—Å–ª–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
–ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–π—Å, –∞ –ø–æ—Ç–æ–º –≤—ã—á–∏—Ç–∞—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ.
–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤—Ä—É—á–Ω—É—é –≤–≤–æ–¥–∏—Ç—å flight_id.
```SQL
with num_seats as (
select 
    aircraft_code,
    count(seat_no) as max_num
from seats
group by aircraft_code
),
cur_seats as (
select 
    aircraft_code,
    count(aircraft_code) as count
from flights
join boarding_passes on flights.flight_id = boarding_passes.flight_id
--join num_seats on flights.aircraft_code = num_seats.aircraft_code
where flights.flight_id = 30625
group by aircraft_code
)
select 
    num_seats.aircraft_code,
    max_num, 
    count as current_seats,
    max_num - count as seats_left
from num_seats
join cur_seats on num_seats.aircraft_code = cur_seats.aircraft_code;
```
```
 aircraft_code | max_num | current_seats | seats_left 
---------------+---------+---------------+------------
 773           |     402 |            92 |        310
```


---
### **–ó–∞–¥–∞–Ω–∏–µ 18.** <a name="–∑–∞–¥–∞–Ω–∏–µ_18"></a>

<details>
<summary>üîΩ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞–Ω–∏–µ üîΩ</summary>
–ó–∞–¥–∞–Ω–∏–µ:

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏–ª–æ—Å—å –∏–º–µ—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–≤–µ–¥–µ–Ω–∏—è –æ 
—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö —Å–∞–º–æ–ª–µ—Ç–æ–≤, —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º—ã—Ö –≤ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏. –ü—É—Å—Ç—å —ç—Ç–æ
–±—É–¥—É—Ç —Ç–∞–∫–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è, –∫–∞–∫ —á–∏—Å–ª–æ —á–ª–µ–Ω–æ–≤ —ç–∫–∏–ø–∞–∂–∞ (–ø–∏–ª–æ—Ç—ã), —Ç–∏–ø –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π –∏ –∏—Ö
–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –≤ —Ç–∞–±–ª–∏—Ü—É ¬´–°–∞–º–æ–ª–µ—Ç—ã¬ª
(`aircrafts`). –î–∞–¥–∏–º –µ–º—É –∏–º—è `specifications`, –∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö 
–≤—ã–±–µ—Ä–µ–º `jsonb`. –ï—Å–ª–∏ –≤–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∏ –¥—Ä—É–≥–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏,
—Ç–æ –º—ã —Å–º–æ–∂–µ–º —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å, –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã.
```SQL
ALTER TABLE aircrafts ADD COLUMN specifications jsonb;
ALTER TABLE
```
–î–æ–±–∞–≤–∏–º —Å–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏ —Å–∞–º–æ–ª–µ—Ç–∞ Airbus A320-200:
```SQL
UPDATE aircrafts
    SET specifications =
    '{ "crew": 2,
    "engines": { "type": "IAE V2500",
                "num": 2
                }
    }'::jsonb
WHERE aircraft_code = '320';

UPDATE 1
```
–ü–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:
```SQL
SELECT model, specifications
FROM aircrafts
WHERE aircraft_code = '320';
```
```
      model      |                     specifications                      
-----------------+---------------------------------------------------------
 Airbus A320-200 | {"crew": 2, "engines": {"num": 2, "type": "IAE V2500"}}
(1 —Å—Ç—Ä–æ–∫–∞)
```
–ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–µ–¥–µ–Ω–∏—è –æ –¥–≤–∏–≥–∞—Ç–µ–ª—è—Ö:
```SQL
SELECT model, specifications->'engines' AS engines
FROM aircrafts
WHERE aircraft_code = '320';
```
```
      model      |             engines             
-----------------+---------------------------------
 Airbus A320-200 | {"num": 2, "type": "IAE V2500"}
(1 —Å—Ç—Ä–æ–∫–∞)
```
–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –µ—â–µ –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ —Ç–∏–ø–µ –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π,
–Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π JSON-–æ–±—ä–µ–∫—Ç –∏–º–µ–µ—Ç —Å–ª–æ–∂–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É: –æ–Ω 
—Å–æ–¥–µ—Ä–∂–∏—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–π JSON-–æ–±—ä–µ–∫—Ç. –ü–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä `#>` –¥–ª—è
—É–∫–∞–∑–∞–Ω–∏—è –ø—É—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª—é—á—É –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è.
```SQL
SELECT model, specifications #> '{ engines, type }'
FROM aircrafts
WHERE aircraft_code = '320';
```
```
WHERE aircraft_code = '320';
      model      |  ?column?   
-----------------+-------------
 Airbus A320-200 | "IAE V2500"
(1 —Å—Ç—Ä–æ–∫–∞)
```
**–ó–∞–¥–∞–Ω–∏–µ**. –ü–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫–∏–µ –µ—â–µ —Ç–∞–±–ª–∏—Ü—ã –±—ã–ª–æ –±—ã —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å
—Å—Ç–æ–ª–±—Ü–∞–º–∏ —Ç–∏–ø–∞ json/jsonb. –í—Å–ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ç–∞–±–ª–∏—Ü–µ ¬´–ë–∏–ª–µ—Ç—ã¬ª
(`tickets`) —É–∂–µ –µ—Å—Ç—å —Å—Ç–æ–ª–±–µ—Ü —Ç–∞–∫–æ–≥–æ —Ç–∏–ø–∞ `contact_data`. –í—ã–ø–æ–ª–Ω–∏—Ç–µ 
–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –≤ –Ω–∏—Ö –æ–¥–Ω—É-–¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏
–≤–∞—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π.
</details>

1. –ü—Ä–µ–¥–ª–∞–≥–∞—é –≤ —Ç–∞–±–ª–∏—Ü—É `airports` –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ —Ç–∏–ø–∞ `jsonb`, –∫–æ—Ç–æ—Ä–æ–µ
–±—É–¥–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è, –∏–º–µ—é—â–∏–µ—Å—è –µ—Å—Ç—å –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ
—á–∞—Å—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –ø–∞—Å—Å–∞–∂–∏—Ä–∞–º: DutyFree, WiFi, –ø–ª–æ—â–∞–¥—å –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞.
```SQL
ALTER TABLE airports ADD COLUMN conditions jsonb;
```
–î–æ–±–∞–≤–∏–º —Å–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏ —Å–∞–º–æ–ª–µ—Ç–∞ Airbus A320-200:
```SQL
UPDATE airports
    SET conditions =
    '{ "WiFi": "free",
    "facilities": { "DutyFree": ["alcohol", "perfume", "watches", "jewelry"],
                    "kids_area": true
                     },
    "square": 10000
    }'::jsonb
WHERE airport_code = 'VKO';

UPDATE airports
    SET conditions =
    '{ "WiFi": "paid",
    "facilities": { "DutyFree": ["alcohol", "perfume"],
                    "kids_area": false
                     },
    "square": 1500
    }'::jsonb
WHERE airport_code = 'MRV';

select airport_name, city, conditions from airports 
where airport_code in ('VKO', 'MRV');
```
```
   airport_name   |       city       |                                                           
conditions                                                           
------------------+------------------+-----------------------------------------------------------
---------------------------------------------------------------------
 –í–Ω—É–∫–æ–≤–æ          | –ú–æ—Å–∫–≤–∞           | {"WiFi": "free", "square": 10000, "facilities": {"DutyFree
": ["alcohol", "perfume", "watches", "jewelry"], "kids_area": true}}
 –ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã | –ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã | {"WiFi": "paid", "square": 1500, "facilities": {"DutyFree"
: ["alcohol", "perfume"], "kids_area": false}}
(2 —Å—Ç—Ä–æ–∫–∏)
```
–ü–æ—Å–º–æ—Ç—Ä–∏–º —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –∫–ª—é—á—É `facilities`:
```SQL
select airport_name, conditions->'facilities' from airports where airport_code in ('VKO', 'MRV')
;
   airport_name   |                                   ?column?                                   
 
------------------+------------------------------------------------------------------------------
-
 –í–Ω—É–∫–æ–≤–æ          | {"DutyFree": ["alcohol", "perfume", "watches", "jewelry"], "kids_area": true}
 –ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã | {"DutyFree": ["alcohol", "perfume"], "kids_area": false}
(2 —Å—Ç—Ä–æ–∫–∏)
```

2. –•–æ—Ç—è –≤ —Ç–∞–±–ª–∏—Ü–µ `tickets` —É–∂–µ –µ—Å—Ç—å –ø–æ–ª–µ —Ç–∏–ø–∞ `jsonb`, –ø—Ä–µ–¥–ª–∞–≥–∞—é –¥–æ–±–∞–≤–∏—Ç—å 
–ø–æ–ª–µ `tariff` —Ç–∏–ø–∞ `jsonb`, 
–≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –¥–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–µ, –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–∞—Å—Å–∞–∂–∏—Ä–æ–º,
–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –µ–¥–∞, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–∞–≥–∞–∂ (–∏ –∫–∞–∫–æ–π) –∏ —Ç.–¥.
```SQL
ALTER TABLE tickets ADD COLUMN tariff jsonb;
```
–î–æ–±–∞–≤–∏–º –ø–∞—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤:
```SQL
UPDATE tickets
    SET tariff =
    '{ "extra_luggage": { "pets": 2, "extra_kilos": 10 },
    "additional": { "food": ["tea", "infant food"]},
    "babies": true
    }'::jsonb
WHERE ticket_no = '0005432000988';

UPDATE tickets
    SET tariff =
    '{ "extra_luggage": { "extra_kilos": 15, "ski": true },
    "additional": { "food": ["alcohol"]},
    "babies": false
    }'::jsonb
WHERE ticket_no = '0005432000991';

select passenger_name, tariff from tickets 
where ticket_no in ('0005432000988', '0005432000991');
```
```
   passenger_name   |                                                      tariff                
                                       
--------------------+----------------------------------------------------------------------------
---------------------------------------
 EVGENIYA ALEKSEEVA | {"babies": true, "additional": {"food": ["tea", "infant food"]}, "extra_lug
gage": {"pets": 2, "extra_kilos": 10}}
 MAKSIM ZHUKOV      | {"babies": false, "additional": {"food": ["alcohol"]}, "extra_luggage": {"s
ki": true, "extra_kilos": 15}}
(2 —Å—Ç—Ä–æ–∫–∏)
```
–°–µ–π—á–∞—Å –∑–¥–µ—Å—å –º–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –≤—ã–≤–µ–¥–µ–º –∏–Ω—Ñ–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ –¥–æ–ø. –±–∞–≥–∞–∂ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤:
```SQL
select passenger_name, tariff-> 'extra_luggage' from tickets 

where ticket_no in ('0005432000988', '0005432000991');
   passenger_name   |             ?column?             
--------------------+----------------------------------
 EVGENIYA ALEKSEEVA | {"pets": 2, "extra_kilos": 10}
 MAKSIM ZHUKOV      | {"ski": true, "extra_kilos": 15}
(2 —Å—Ç—Ä–æ–∫–∏)
```

3. –ï—â–µ –ø—Ä–µ–¥–ª–∞–≥–∞—é –≤ —Ç–∞–±–ª–∏—Ü—É `bookings` –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `payment_info` —Ç–∏–ø–∞ `jsonb`, 
–≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –≠—Ç–æ –º–æ–∂–µ—Ç 
–ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –≤ —Ü–µ–ª—è—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: –∫–∞–∫ —á–∞—â–µ –≤—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç—ã –æ–ø–ª–∞—á–∏–≤–∞—é—Ç 
–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –Ω–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ, –∏ –∫–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Å—É–º–º–æ–π –∑–∞–∫–∞–∑–∞.
```SQL
ALTER TABLE bookings ADD COLUMN payment_info jsonb;
```
–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤:
```SQL
UPDATE bookings
    SET payment_info =
    '{ "payment_type": "cash",
    "book_type": {"online": "phone"}
    }'::jsonb
WHERE book_ref = '000012';

UPDATE bookings
    SET payment_info =
    '{ "payment_type": "card",
    "book_type": {"offline": "ticket_office"}
    }'::jsonb
WHERE book_ref = '000181';

select book_ref, total_amount, payment_info from bookings 
where book_ref in ('000012', '000181');
```
```
 book_ref | total_amount |                            payment_info                             
----------+--------------+---------------------------------------------------------------------
 000012   |     37900.00 | {"book_type": {"online": "phone"}, "payment_type": "cash"}
 000181   |    131800.00 | {"book_type": {"offline": "ticket_office"}, "payment_type": "card"}
(2 —Å—Ç—Ä–æ–∫–∏)
```
–ü–æ–ª—É—á–∏–ª–æ—Å—å —É—Å–ø–µ—à–Ω–æ.

---